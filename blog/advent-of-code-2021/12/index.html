<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Advent of Code 2021 Day 12: Passage Pathing | Brain Dump</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="Cellular automation in a 2D grid.">
<meta name=generator content="Hugo 0.89.4">
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel=stylesheet href=/ananke/css/main.min.css>
<meta property="og:title" content="Advent of Code 2021 Day 12: Passage Pathing">
<meta property="og:description" content="Cellular automation in a 2D grid.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.roessland.com/blog/advent-of-code-2021/12/"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2021-12-12T00:00:00+00:00">
<meta property="article:modified_time" content="2021-12-12T00:00:00+00:00">
<meta itemprop=name content="Advent of Code 2021 Day 12: Passage Pathing">
<meta itemprop=description content="Cellular automation in a 2D grid."><meta itemprop=datePublished content="2021-12-12T00:00:00+00:00">
<meta itemprop=dateModified content="2021-12-12T00:00:00+00:00">
<meta itemprop=wordCount content="407">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="Advent of Code 2021 Day 12: Passage Pathing">
<meta name=twitter:description content="Cellular automation in a 2D grid.">
<script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.13.4/mermaid.min.js integrity="sha512-JERecFUBbsm75UpkVheAuDOE8NdHjQBrPACfEQYPwvPG+fjgCpHAz1Jw2ci9EXmd3DdfiWth3O3CQvcfEg8gsA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>window.addEventListener('DOMContentLoaded',function(){let a=document.getElementsByClassName("language-mermaid");for(let b of a){let c=b.parentElement;c.before(b),c.remove()}mermaid.init(void 0,".language-mermaid")})</script>
</head>
<body class="ma0 avenir bg-near-white">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=/ class="f3 fw2 hover-white no-underline white-90 dib">
Brain Dump
</a>
<div class="flex-l items-center">
<div class=ananke-socials>
<a href=https://github.com/roessland target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">
<span class=icon><svg height="50" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
</span>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
</div>
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
BLOGS
</aside>
<div id=sharing class="mt3 ananke-socials">
</div>
<h1 class="f1 athelas mt3 mb1">Advent of Code 2021 Day 12: Passage Pathing</h1>
<p class=tracked>
By <strong>
Andreas Røssland
</strong>
</p>
<time class="f6 mv4 dib tracked" datetime=2021-12-12T00:00:00Z>December 12, 2021</time>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p><a href=https://adventofcode.com/2021/day/12>https://adventofcode.com/2021/day/12</a></p>
<p>Finally a graph problem. This turns out to be a variation of DFS (depth-first search), that I solved using recursion. Since the path search must be exhaustive (find all paths) we can use DFS instead of BFS (breadth-first search) which is slightly easier to implement. In addition there is no need to keep passing down copies of the <code>visited</code> state since each step of DFS can effectively &ldquo;undo&rdquo; what it did before recursing, making it possible to use a single shared <code>map</code> for storing this.</p>
<p>For part 2 any single small cave can be visited <em>twice</em> instead of just once, drastically increasing the number of possible paths. I solved this by giving the search a &ldquo;token&rdquo;. If a small cave is already visited, the token can be used to visit the cave again. The token can only be used once for each path from start to end, and is optional to use.</p>
<p>Finally, I optimized the solution by returning the <em>number of paths</em> instead of the entire <em>list of paths</em>. This reduced the runtime from 0.9 seconds to around 0.05 seconds.</p>
<pre tabindex=0><code>package main

import (
	&quot;bufio&quot;
	&quot;fmt&quot;
	&quot;log&quot;
	&quot;os&quot;
	&quot;strings&quot;
	&quot;time&quot;
)



func main() {
	t0 := time.Now()
	g := ReadInput()
	part1(g)
	part2(g)
	fmt.Println(time.Since(t0))

}

func part1(g Graph) {
	visited := map[string]int{}
	paths := search(g, &quot;start&quot;, visited, false)
	fmt.Println(&quot;Part 1:&quot;, paths)
}

func part2(g Graph) {
	visited := map[string]int{}
	paths := search(g, &quot;start&quot;, visited, true)
	fmt.Println(&quot;Part 2:&quot;, paths)
}

func search(g Graph, fromId string, visited map[string]int, token bool) int {
	if fromId == &quot;end&quot; {
		return 1
	}
	if IsSmall(fromId) {
		visited[fromId]++
	}
	var paths int
	for _, neighborId := range g[fromId] {
		if neighborId == &quot;start&quot; {
			continue
		}
		if visited[neighborId] == 0 {
			// Visit without using token
			paths += search(g, neighborId, visited, token)
		} else if IsSmall(neighborId) &amp;&amp; token {
			// Visit using token
			paths += search(g, neighborId, visited, false)

		}
	}
	if IsSmall(fromId) {
		visited[fromId]--
	}
	return paths
}

type Graph map[string][]string

func (g Graph) AddNode(id string) {
	if g[id] == nil {
		g[id] = make([]string, 0)
	}
}

func (g Graph) AddEdge(nodeId1 string, nodeId2 string) {
	g[nodeId1] = append(g[nodeId1], nodeId2)
	g[nodeId2] = append(g[nodeId2], nodeId1)
}

func IsSmall(nodeId string) bool {
	return strings.ToLower(nodeId) == nodeId
}

func ReadInput() Graph {
	f, err := os.Open(&quot;input.txt&quot;)
	if err != nil {
		log.Fatal(err)
	}
	scanner := bufio.NewScanner(f)
	g := make(Graph)
	for scanner.Scan() {
		nodes := strings.Split(scanner.Text(), &quot;-&quot;)
		g.AddNode(nodes[0])
		g.AddNode(nodes[1])
		g.AddEdge(nodes[0], nodes[1])
	}
	return g
}
</code></pre><ul class=pa0>
</ul>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l">
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://www.roessland.com/>
&copy; Andreas Røssland 2021
</a>
<div>
<div class=ananke-socials>
<a href=https://github.com/roessland target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">
<span class=icon><svg height="50" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
</span>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
</div></div>
</div>
</footer>
</body>
</html>